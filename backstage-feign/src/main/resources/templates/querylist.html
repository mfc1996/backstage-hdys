<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Title</title>
</head>
<script src="../js/jquery.min.js"></script>
<script src="../js/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script>
<link type="text/css" rel="stylesheet" href="../js/bootstrap3/css/bootstrap.css"></link>
<link type="text/css" rel="stylesheet" href="../js/bootstrap-table/bootstrap-table.css"></link>
<link type="text/css" rel="stylesheet" href="../js/bootstrap-datetimepicker/css/bootstrap-datetimepicker.css"></link>
<link type="text/css" rel="stylesheet" href="../js/bootstrap-fileinput/css/fileinput.css"></link>

<script src="../js/bootstrap3/js/bootstrap.js"></script>
<script src="../js/bootstrap-bootbox/bootbox.js"></script>
<script src="../js/bootstrap-table/bootstrap-table.js"></script>
<script src="../js/bootstrap-table/locale/bootstrap-table-zh-CN.js"></script>
<script src="../js/bootstrap-datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js"></script>
<script src="../js/bootstrap-fileinput/js/fileinput.js"></script>
<script src="../js/bootstrap-fileinput/js/locales/zh.js"></script>
<body>

<div>
    <form class="form-inline" id="toolbar">
        <button onclick="delAll()" type="button" class="btn btn-primary glyphicon glyphicon-minus">批量删除</button>
        <button onclick="openUser()" type="button" class="btn btn-primary glyphicon glyphicon-plus">新增</button>
    </form>
</div>


<table class="table" id="proTable"></table>
</body>
<script>

    $(function(){
        initPro();
    })

    //查询用户信息
    function initPro(){
        $('#proTable').bootstrapTable({
            url:'../queryProList',//获取数据地址
            pagination:true, //是否展示分页
            pageList:[3,5, 10, 20, 50],//分页组件
            pageNumber:1,
            pageSize:3,//默认每页条数
            showPaginationSwitch:false,//是否显示 数据条数选择框
            clickToSelect: true, //是否启用点击选中行
            sidePagination:'server',//分页方式：client客户端分页，server服务端分页（*
            striped:true,
            queryParams:function(){

                return {
                    page: this.pageNumber,
                    rows: this.pageSize
                }
            },
            columns:[
                {checkbox:true},
                {field:'productId',title:'商品编号',align:'center'},
                {field:'productName',title:'商品名称',align:'center'},
                {field:'productPrice',title:'产品价格',align:'center'},
                {field:'productStockId',title:'产品库存'},
                {field:'productDeliveryTime',title:'产品发货时间'},
                {field:'productTransactionId',title:'产品交易情况'},
                {field:'paymentId',title:'交易方式',formatter:function(rows,index,value){
                        return value==1?"微信":"支付宝"
                    }},
                {field:'proDealCount',title:'交易数量'},
                {field:'productState',title:'是否上架',formatter:function(rows,index,value){
                        return value==1?"上架":"下架"
                    }},
                {field:'qwer',title:'操作',align:'center',formatter:function(value,row,index){
                        return '<button onclick="del('+row.productId+')" type="button" class="btn btn-primary glyphicon glyphicon-minus">修改</button> |<button onclick="upd('+row.productId+')" type="button" class="btn btn-primary glyphicon glyphicon-minus">推广</button> |<button onclick="upd(\'+row.productId+\')" type="button" class="btn btn-primary glyphicon glyphicon-minus">上/下架</button>';
                    }}
            ]
        });
    }

/****************************************************************删除**********************************************************************/
    //批删
    function delAll(){
        var proTables = $("#proTable").bootstrapTable('getSelections');
        if (proTables.length <= 0) {
            bootbox.alert({
                size: "small",
                title: "提示",
                message: "请选择有效数据",
                callback: function(){}
            })
            return;
        }

        bootbox.confirm({
            title:"提示",
            message: "确认要删除选中的数据吗？",
            buttons: {
                confirm: {
                    label: 'Yes',
                    className: 'btn-success'
                },
                cancel: {
                    label: 'No',
                    className: 'btn-danger'
                }
            },
            callback: function (result) {
                if(result){
                    var ids= "";
                    for (var i = 0; i < proTables.length; i++) {
                        ids += ids == "" ? proTables[i].productId : ","+proTables[i].productId;
                    }
                    $.ajax({
                        url:'../delPro/'+ids,
                        type:'delete',
                        data:{},
                        success:function(){
                            bootbox.alert({
                                size: "small",
                                title: "提示",
                                message: "删除成功!",
                                callback: function () {
                                }
                            })
                            $("#proTable").bootstrapTable('refresh');
                        }
                    });
                }
            }
        });
    }


/***************************************************************新增**********************************************************************/
    var res;
    function createAddContent(url){
        $.ajax({
            url:url,
            async:false,
            success:function(data){
                res = data;
            }
        });
        return res;
    }
    //打开新增弹框
    function openUser(){
        bootbox.dialog({
            title:'新增',
            message: createAddContent("../page/addPro"),
            closeButton: true,
            buttons : {
                "success" : {
                    "label" : "<i class='icon-ok'></i> 保存",
                    "className" : "btn-sm btn-success",
                    "callback" : function() {
                        var productName = $("#productName").val();
                        var productPrice = $("#productPrice").val();
                        var productStockId = $("#productStockId").val();
                        var productDeliveryTime = $("#productDeliveryTime").val();
                        var paymentId = $('#paymentId input:radio:checked').val();
                        var proDealCount = $("#proDealCount").val();
                        var productState = $('#productState input:radio:checked').val()
                        $.ajax({
                            url:'../savePro',
                            type:'post',
                            contentType: "application/json",
                            data:JSON.stringify({
                                'productName': productName,
                                'productPrice': productPrice,
                                'productStockId': productStockId,
                                'productDeliveryTime': productDeliveryTime,
                                'paymentId': paymentId,
                                'proDealCount': proDealCount,
                                'productState': productState
                            }),
                            dataType:'json',
                            success:function(data){
                                bootbox.alert({
                                    size: "small",
                                    title: "提示",
                                    message: "新增成功成功!",
                                    callback: function () {
                                    }
                                })
                               $('#proTable').bootstrapTable('refresh');
                            }
                        });
                    }
                },
                "cancel" : {
                    "label" : "<i class='icon-info'></i> 取消",
                    "className" : "btn-sm btn-danger",
                    "callback" : function() {

                    }
                }
            }
        });
    }

    function searchPro(){
        $("#proTable").bootstrapTable('refresh');
    }

    $('.date').datetimepicker({
        language: 'zh-CN',//显示中文
        format: 'yyyy-mm-dd',//显示格式
        minView: "month",//设置只显示到月份
        initialDate: new Date(),//初始化当前日期
        autoclose: true,//选中自动关闭
        todayBtn: true//显示今日按钮
    });



</script>
</html>